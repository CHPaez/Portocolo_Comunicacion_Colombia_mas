<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Solicitud de Contrataci√≥n - Colombia M√°s</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Librer√≠as -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
  body { font-family: "Segoe UI"; background: #f3f6f9; padding: 30px; }
  .contenedor {
    max-width: 850px; background: white; padding: 25px;
    border-radius: 12px; margin: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }
  h1 { color: #004a99; margin-bottom: 5px; }
  label { font-weight: 600; display:block; margin-top: 10px; }
  input, select, textarea {
    width:100%; padding:10px; border-radius:8px;
    border:1px solid #ced4da; margin-top: 4px;
  }
  button {
    margin-top:18px; padding:12px 20px; border:0;
    background:#0078ff; color:white; font-weight:700;
    border-radius:8px; cursor:pointer;
  }
  .mensaje { margin-top:15px; font-size:15px; }
</style>

</head>
<body>

<div class="contenedor">
  <h1>Solicitud de Contrataci√≥n</h1>
  <p>Se generar√° un PDF y Excel, se subir√°n autom√°ticamente y se enviar√° un correo con los enlaces.</p>

  <form id="formulario">

    <label>√Årea solicitante</label>
    <input id="area" required>

    <label>Jefe inmediato</label>
    <input id="jefe" required>

    <label>Correo jefe inmediato</label>
    <input id="correoJefe" type="email" required>

    <label>Cargo solicitado</label>
    <input id="cargo" required>

    <label>Tipo de contrato</label>
    <select id="contrato" required>
      <option value="">Selecciona...</option>
      <option>Indefinido</option>
      <option>T√©rmino fijo</option>
      <option>Prestaci√≥n de servicios</option>
    </select>

    <label>Fecha estimada ingreso</label>
    <input type="date" id="fecha" required>

    <label>Ciudad / Sede</label>
    <input id="sede" required>

    <label>Jornada</label>
    <select id="jornada" required>
      <option value="">Selecciona...</option>
      <option>Tiempo completo</option>
      <option>Medio tiempo</option>
      <option>Turnos</option>
    </select>

    <label>Motivo</label>
    <input id="motivo" required>

    <label>Perfil requerido</label>
    <textarea id="perfil" required></textarea>

    <label>Observaciones</label>
    <textarea id="obs"></textarea>

    <button type="button" onclick="generarYEnviar()">Enviar Solicitud</button>

  </form>

  <div class="mensaje" id="mensaje"></div>
</div>

<script>
// ‚≠ê GENERA NOMBRE DE ARCHIVO AUTOM√ÅTICO
function nombreArchivo(ext) {
  const f = new Date();
  const fecha =
    f.getFullYear() + "-" +
    String(f.getMonth()+1).padStart(2,"0") + "-" +
    String(f.getDate()).padStart(2,"0") + "_" +
    String(f.getHours()).padStart(2,"0") + "-" +
    String(f.getMinutes()).padStart(2,"0") + "-" +
    String(f.getSeconds()).padStart(2,"0");
  return `solicitud_${fecha}.${ext}`;
}

// ‚≠ê GENERA PDF
async function generarPDF(datos) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 15;
  doc.setFontSize(14);
  doc.text("Solicitud de Contrataci√≥n - Colombia M√°s", 10, y);
  y += 10;
  doc.setFontSize(10);

  datos.forEach(([campo, valor]) => {
    doc.text(`${campo}: ${valor}`, 10, y);
    y += 7;
  });

  return doc.output("blob");
}

// ‚≠ê GENERA EXCEL
function generarExcel(datos) {
  const ws = XLSX.utils.aoa_to_sheet([["Campo","Valor"], ...datos]);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Solicitud");
  return new Blob([XLSX.write(wb, { bookType:"xlsx", type:"array" })]);
}

// SUBE ARCHIVO A TRANSFER.SH - CORREGIDO
async function subirATransfer(blob, nombre) {
    const formData = new FormData();
    formData.append("file", blob, nombre);

    const resp = await fetch("https://transfer.sh/", {
        method: "POST",
        body: formData
    });

    if (!resp.ok) {
        throw new Error("Error subiendo archivo: " + resp.status);
    }

    return await resp.text(); // devuelve el link p√∫blico del archivo
}


// ‚≠ê GENERA Y ENV√çA TODO
async function generarYEnviar() {
  const msg = document.getElementById("mensaje");
  msg.innerHTML = "Generando archivos‚Ä¶";

  const datos = [
    ["√Årea solicitante", area.value],
    ["Jefe inmediato", jefe.value],
    ["Correo jefe", correoJefe.value],
    ["Cargo", cargo.value],
    ["Contrato", contrato.value],
    ["Fecha ingreso", fecha.value],
    ["Sede", sede.value],
    ["Jornada", jornada.value],
    ["Motivo", motivo.value],
    ["Perfil", perfil.value],
    ["Observaciones", obs.value]
  ];

  // Generar archivos
  const pdfBlob = await generarPDF(datos);
  const excelBlob = generarExcel(datos);

  const pdfName = nombreArchivo("pdf");
  const excelName = nombreArchivo("xlsx");

  msg.innerHTML = "Subiendo archivos‚Ä¶";

  // Subir archivos
  const urlPDF = await subirATransfer(pdfBlob, pdfName);
  const urlExcel = await subirATransfer(excelBlob, excelName);

  msg.innerHTML = "Enviando correo‚Ä¶";

  // Enviar correo con FormSubmit
  await fetch("https://formsubmit.co/ajax/cepb@hotmail.es", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      asunto: "Nueva solicitud de contrataci√≥n",
      pdf: urlPDF,
      excel: urlExcel
    })
  });

  msg.innerHTML = `
    <span style="color:green;font-weight:700">
      Solicitud enviada correctamente.<br><br>
      <a href="${urlPDF}" target="_blank">üìÑ Descargar PDF</a><br>
      <a href="${urlExcel}" target="_blank">üìä Descargar Excel</a>
    </span>`;
}
</script>

</body>
</html>







